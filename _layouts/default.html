<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} | {{ site.title }}</title>
    <meta name="description" content="{{ site.description }}">
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css?v={{ site.time | date: '%s' }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicon.ico">
</head>

<body>

    <header class="site-header">
        <div class="container">
            <a href="{{ site.baseurl }}/" class="site-logo">
                <img src="{{ site.baseurl }}/assets/images/logo.png" alt="KubeDesk Logo" class="logo-img">
                KubeDesk
            </a>
            <nav class="site-nav">
                <a href="https://github.com/akkezi/KubeDesk" target="_blank">GitHub</a>
                <a href="{{ site.baseurl }}/docs">Docs</a>
            </nav>
        </div>
    </header>

    <main class="page-content" aria-label="Content">
        {{ content }}
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; {{ site.time | date: "%Y" }} KubeDesk. All rights reserved.</p>
            <div class="footer-links">
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
                <a href="https://github.com/akkezi/KubeDesk">GitHub</a>
            </div>
        </div>
    </footer>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-links">
                <a href="https://github.com/akkezi/KubeDesk" target="_blank">GitHub</a>
                <a href="#">Documentation</a>
                <a href="https://github.com/akkezi/KubeDesk/issues" target="_blank">Report an Issue</a>
            </div>
            <p style="color: #484f58; font-size: 0.85rem;">&copy; {{ site.time | date: '%Y' }} KubeDesk</p>
        </div>
    </footer>

    <!-- Lightbox Modal -->
    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <a class="prev" onclick="changeSlide(-1)">&#10094;</a>
        <img class="lightbox-content" id="lightbox-img">
        <a class="next" onclick="changeSlide(1)">&#10095;</a>
    </div>

    <script>
        let currentIndex = 0;

        function openLightbox(imgElement) {
            const lightbox = document.getElementById("lightbox");
            const allImages = Array.from(document.querySelectorAll('.gallery-scroll img'));

            currentIndex = allImages.indexOf(imgElement);
            updateLightboxImage();

            lightbox.style.display = "flex";
            document.body.style.overflow = "hidden"; // Prevent scrolling
        }

        function closeLightbox() {
            document.getElementById("lightbox").style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
        }

        function changeSlide(n) {
            const allImages = document.querySelectorAll('.gallery-scroll img');
            currentIndex += n;
            if (currentIndex >= allImages.length) currentIndex = 0;
            if (currentIndex < 0) currentIndex = allImages.length - 1;
            updateLightboxImage();
        }

        function updateLightboxImage() {
            const allImages = document.querySelectorAll('.gallery-scroll img');
            const lightboxImg = document.getElementById("lightbox-img");
            // Add check to ensure images exist
            if (allImages.length > 0) {
                lightboxImg.src = allImages[currentIndex].src;
            }
        }

        // Close on click OUTSIDE image (on background)
        document.getElementById('lightbox').addEventListener('click', function (e) {
            if (e.target === this) {
                closeLightbox();
            }
        });

        // Keydown events
        document.addEventListener('keydown', function (event) {
            if (document.getElementById("lightbox").style.display === "flex") {
                if (event.key === "Escape") closeLightbox();
                if (event.key === "ArrowLeft") changeSlide(-1);
                if (event.key === "ArrowRight") changeSlide(1);
            }
        });

        // ── App Simulator ────────────────────────────────────────────────────

        function switchTab(element, categoryId) {
            // Sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');

            // Masquer tous les tab-content inactifs + réinitialiser leurs cartes
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.querySelectorAll('.content-card').forEach(card => {
                    card.classList.remove('visible');
                    card.style.opacity       = '0';
                    card.style.animationName = 'none';
                });
            });

            // Activer l'onglet cible
            const target = document.getElementById(categoryId);
            if (!target) return;
            target.classList.add('active');
            randomizeCards(target);
        }

        function randomizeCards(tabContent) {
            // Double rAF pour que le DOM soit rendu avant de mesurer
            requestAnimationFrame(() => requestAnimationFrame(() => {

                // La référence de taille est .app-content (parent de .tab-content)
                // Les cartes sont dans .content-grid (position:relative, enfant de .tab-content)
                const appContent = tabContent.parentElement;  // .app-content
                const grid       = tabContent.querySelector('.content-grid');
                if (!grid) return;

                const W = appContent ? appContent.offsetWidth  : grid.offsetWidth;
                const H = appContent ? appContent.offsetHeight : grid.offsetHeight;

                const isMobile = window.innerWidth <= 768;
                const CARD_W   = isMobile ? 120 : 155;
                const CARD_H   = 36;
                const MARGIN   = 8;
                const numCols  = isMobile ? 2 : 4;

                const cards = Array.from(grid.querySelectorAll('.content-card'));
                if (!cards.length) return;

                // Mélanger
                cards.sort(() => Math.random() - 0.5);

                // Init drag une seule fois par carte
                cards.forEach(card => {
                    if (!card.dataset.draggable) {
                        card.dataset.draggable = '1';
                        makeDraggable(card);
                    }
                });

                // Répartir en colonnes
                const cols = Array.from({ length: numCols }, () => []);
                cards.forEach((c, i) => cols[i % numCols].push(c));

                const colW  = W / numCols;
                const yMax  = Math.max(CARD_H + MARGIN, H - CARD_H - MARGIN);

                cols.forEach((items, ci) => {
                    if (!items.length) return;
                    const xMin   = ci * colW + MARGIN;
                    const xRange = Math.max(0, colW - CARD_W - MARGIN * 2);

                    items.forEach((card, i) => {
                        card.classList.remove('visible');

                        // Distribution verticale uniforme sur toute la hauteur
                        const baseY  = items.length > 1 ? (i / (items.length - 1)) * yMax : yMax / 2;
                        const jitter = (Math.random() - 0.5) * H * 0.08;
                        const top    = Math.max(MARGIN, Math.min(yMax, baseY + jitter));
                        const left   = xMin + Math.random() * xRange;

                        card.style.left = left + 'px';
                        card.style.top  = top  + 'px';

                        applyAnimation(card, isMobile);
                        setTimeout(() => card.classList.add('visible'), i * 55);
                    });
                });
            }));
        }

        function applyAnimation(card, isMobile) {
            const mobile  = ['cloud-a','cloud-b','cloud-c','cloud-d','cloud-e'];
            const desktop = ['float','float1','float2','float3'];
            const list    = isMobile ? mobile : desktop;
            card.style.animationName            = list[Math.floor(Math.random() * list.length)];
            card.style.animationDuration        = (isMobile ? 6 + Math.random() * 8 : 4 + Math.random() * 3) + 's';
            card.style.animationDelay           = (Math.random() * (isMobile ? 3 : 2)) + 's';
            card.style.animationTimingFunction  = 'ease-in-out';
            card.style.animationIterationCount  = 'infinite';
        }

        function makeDraggable(el) {
            let on = false, sx, sy, il, it;
            el.addEventListener('mousedown',  s);
            el.addEventListener('touchstart', s, { passive: false });
            window.addEventListener('mousemove',  m);
            window.addEventListener('touchmove',  m, { passive: false });
            window.addEventListener('mouseup',    e);
            window.addEventListener('touchend',   e);
            function s(ev) {
                on = true;
                sx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                sy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                il = parseFloat(window.getComputedStyle(el).left) || 0;
                it = parseFloat(window.getComputedStyle(el).top)  || 0;
                el.style.animationName = 'none';
                el.style.zIndex = '100';
                el.style.cursor = 'grabbing';
            }
            function m(ev) {
                if (!on) return;
                ev.preventDefault();
                const cx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                const cy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                el.style.left = (il + cx - sx) + 'px';
                el.style.top  = (it + cy - sy) + 'px';
            }
            function e() {
                if (!on) return;
                on = false;
                el.style.cursor = 'grab';
                el.style.zIndex = '';
            }
        }

        // Init au chargement — l'onglet actif au départ est "dashboard"
        document.addEventListener('DOMContentLoaded', () => {
            const active = document.querySelector('.sidebar-item.active');
            if (active) {
                const m = (active.getAttribute('onclick') || '').match(/switchTab\s*\([^,]+,\s*['"]([^'"]+)['"]/);
                if (m) switchTab(active, m[1]);
            }
        });
    </script>
</body>

</html>